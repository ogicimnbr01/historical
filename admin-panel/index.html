<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calibration Admin Panel</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="app">
        <header class="header">
            <h1>ðŸ“Š Calibration Admin</h1>
            <div class="api-key-container">
                <input type="password" id="apiKeyInput" placeholder="API Key" />
                <button onclick="setApiKey()">Set</button>
            </div>
        </header>

        <nav class="nav">
            <button class="nav-btn active" onclick="showDashboard()">Dashboard</button>
            <button class="nav-btn" onclick="showVideoList()">Videos</button>
            <button class="nav-btn" onclick="showSystemActivity()">ðŸš€ System Activity</button>
        </nav>

        <main id="content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section">
                <h2>Dashboard</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <span class="stat-value" id="statTotal">-</span>
                        <span class="stat-label">Total Videos</span>
                    </div>
                    <div class="stat-card eligible">
                        <span class="stat-value" id="statEligible">-</span>
                        <span class="stat-label">Eligible</span>
                    </div>
                    <div class="stat-card pending">
                        <span class="stat-value" id="statPending">-</span>
                        <span class="stat-label">Pending</span>
                    </div>
                    <div class="stat-card complete">
                        <span class="stat-value" id="statComplete">-</span>
                        <span class="stat-label">Complete</span>
                    </div>
                    <div class="stat-card failed">
                        <span class="stat-value" id="statFailed">-</span>
                        <span class="stat-label">Failed</span>
                    </div>
                    <div class="stat-card test">
                        <span class="stat-value" id="statTest">-</span>
                        <span class="stat-label">Test</span>
                    </div>
                </div>

                <div class="metrics-row">
                    <div class="metric-card">
                        <span class="metric-value" id="metricMAE">-</span>
                        <span class="metric-label">MAE (Retention %)</span>
                    </div>
                    <div class="metric-card">
                        <span class="metric-value" id="metricCorr">-</span>
                        <span class="metric-label">Correlation</span>
                    </div>
                    <div class="metric-card">
                        <span class="metric-value" id="metricSample">-</span>
                        <span class="metric-label">Sample Size</span>
                    </div>
                    <div class="metric-card">
                        <span class="metric-value" id="metricEligibleRate">-</span>
                        <span class="metric-label">Eligible Rate</span>
                    </div>
                </div>

                <!-- Generate Video Card -->
                <div class="generate-card">
                    <h3>ðŸŽ¬ Generate Video</h3>
                    <div class="generate-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="genMode">Mode</label>
                                <select id="genMode">
                                    <option value="auto">Auto (Autopilot)</option>
                                    <option value="quality">Quality</option>
                                    <option value="fast">Fast</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="genTitleVariant">Title Variant</label>
                                <select id="genTitleVariant">
                                    <option value="auto">Auto</option>
                                    <option value="bold">Bold</option>
                                    <option value="safe">Safe</option>
                                    <option value="experimental">Experimental</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="genTopic">Topic Override (optional)</label>
                                <input type="text" id="genTopic" placeholder="e.g., 'The history of coffee'">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="toggle-label">
                                    <input type="checkbox" id="genEligible" checked>
                                    Calibration Eligible
                                </label>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn-primary" onclick="generateVideo()">ðŸš€ Generate Now</button>
                            <button class="btn-secondary" onclick="generateTestVideo()">ðŸ§ª Generate & Mark TEST</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- System Activity Section -->
            <section id="systemActivity" class="section hidden">
                <h2>ðŸš€ System Activity</h2>
                <div class="activity-controls">
                    <button class="refresh-btn" onclick="loadSystemActivity()">ðŸ”„ Refresh</button>
                    <select id="jobStatusFilter" onchange="loadSystemActivity()">
                        <option value="">All Status</option>
                        <option value="queued">Queued</option>
                        <option value="running">Running</option>
                        <option value="completed">Completed</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
                <div class="jobs-timeline" id="jobsTimeline">
                    <p class="loading-text">Loading jobs...</p>
                </div>
            </section>

            <!-- Video List Section -->
            <section id="videoList" class="section hidden">
                <h2>Videos</h2>

                <div class="filters">
                    <select id="filterStatus" onchange="loadVideos()">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="linked">Linked</option>
                        <option value="complete">Complete</option>
                        <option value="failed">Failed</option>
                        <option value="test">Test</option>
                    </select>
                    <select id="filterEligible" onchange="loadVideos()">
                        <option value="">All Eligible</option>
                        <option value="true">Eligible Only</option>
                        <option value="false">Ineligible Only</option>
                    </select>
                    <select id="filterMode" onchange="loadVideos()">
                        <option value="">All Modes</option>
                        <option value="fast">Fast</option>
                        <option value="quality">Quality</option>
                    </select>
                    <select id="filterFallback" onchange="loadVideos()">
                        <option value="">All Pipeline</option>
                        <option value="true">Fallback Only</option>
                        <option value="false">v2.3 Only</option>
                    </select>
                    <button class="refresh-btn" onclick="loadVideos()">ðŸ”„ Refresh</button>
                </div>

                <div class="bulk-actions">
                    <button onclick="markSelectedAsTest()" class="bulk-btn">Mark Selected as TEST</button>
                    <span id="selectedCount">0 selected</span>
                </div>

                <table class="videos-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                            <th>Video ID</th>
                            <th>Title</th>
                            <th>Date</th>
                            <th>Mode</th>
                            <th>Predicted</th>
                            <th>Actual</th>
                            <th>Pipeline</th>
                            <th>Eligible</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="videosTableBody">
                    </tbody>
                </table>
            </section>

            <!-- Video Detail Modal -->
            <div id="videoModal" class="modal hidden">
                <div class="modal-content">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <h2 id="modalTitle">Video Details</h2>
                    <div id="modalBody"></div>
                </div>
            </div>

            <!-- Logs Modal -->
            <div id="logsModal" class="modal hidden">
                <div class="modal-content wide">
                    <span class="close" onclick="closeLogsModal()">&times;</span>
                    <h2 id="logsModalTitle">ðŸ“‹ Job Logs</h2>
                    <div class="logs-filters">
                        <select id="logComponentFilter" onchange="filterLogs()">
                            <option value="">All Components</option>
                            <option value="video_generator">video_generator</option>
                            <option value="analytics_fetcher">analytics_fetcher</option>
                            <option value="decision_engine">decision_engine</option>
                        </select>
                        <select id="logLevelFilter" onchange="filterLogs()">
                            <option value="">All Levels</option>
                            <option value="INFO">INFO</option>
                            <option value="WARN">WARN</option>
                            <option value="ERROR">ERROR</option>
                        </select>
                    </div>
                    <div id="logsContainer" class="logs-container"></div>
                </div>
            </div>

            <!-- Toast container -->
            <div id="toastContainer" class="toast-container"></div>
        </main>
    </div>

    <script src="app.js"></script>
</body>

</html>